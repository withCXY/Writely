<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Read-only Translation Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .readonly-text {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            margin: 20px 0;
        }
        .editable-text {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #007bff;
            margin: 20px 0;
        }
        .status {
            background-color: #d4edda;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>🧪 Read-only Translation Test</h1>
    
    <div class="status">
        ✅ Current Implementation Status: Read-only translation feature is already implemented!
    </div>

    <h2>📖 Read-only Text (Should show translation popup)</h2>
    <div class="readonly-text">
        <p><strong>English:</strong> Hello world! This is a test of the read-only translation feature. Select this text and translate it to see the popup result.</p>
        
        <p><strong>Chinese:</strong> 你好世界！这是只读翻译功能的测试。选择这段文字并翻译它，查看弹出结果。</p>
        
        <p><strong>Spanish:</strong> ¡Hola mundo! Esta es una prueba de la función de traducción de solo lectura. Selecciona este texto y tradúcelo para ver el resultado emergente.</p>
    </div>

    <h2>✏️ Editable Text (Should replace text directly)</h2>
    <textarea class="editable-text" rows="4" style="width: 100%; resize: vertical;">
This is editable text. When you translate this, it should directly replace the selected text instead of showing a popup.
    </textarea>

    <div contenteditable="true" class="editable-text">
        This is a contenteditable div. Translation should also replace text directly here.
    </div>

    <h2>🔍 How to Test</h2>
    <ol>
        <li><strong>Select text in the gray read-only area above</strong></li>
        <li><strong>Click the AI Assistant icon</strong></li>
        <li><strong>Notice the menu shows only "Translate ▸" and "Close"</strong></li>
        <li><strong>Click "Translate ▸" and choose a language</strong></li>
        <li><strong>Verify translation appears in a popup window</strong></li>
        <li><strong>Verify original text remains unchanged</strong></li>
        <li><strong>Test the "Copy Translation" button</strong></li>
    </ol>

    <h2>📋 Expected Behavior</h2>
    <ul>
        <li>✅ <strong>Read-only text</strong>: Shows translation in popup, original text unchanged</li>
        <li>✅ <strong>Editable text</strong>: Directly replaces selected text</li>
        <li>✅ <strong>Menu differences</strong>: Read-only shows fewer options</li>
        <li>✅ <strong>Copy functionality</strong>: Copy button works in popup</li>
    </ul>

    <script>
        console.log('Simple read-only translation test loaded');
        
        // Debug selection detection
        document.addEventListener('selectionchange', function() {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();
            
            if (selectedText && selectedText.length > 5) {
                // Determine if selection is in editable area
                const range = selection.getRangeAt(0);
                const element = range.commonAncestorContainer.nodeType === Node.TEXT_NODE 
                    ? range.commonAncestorContainer.parentElement 
                    : range.commonAncestorContainer;
                
                // Check editability
                let isEditable = false;
                let checkElement = element;
                while (checkElement && checkElement !== document.body) {
                    if (checkElement.isContentEditable || 
                        checkElement.tagName === 'TEXTAREA' || 
                        checkElement.tagName === 'INPUT') {
                        isEditable = true;
                        break;
                    }
                    checkElement = checkElement.parentElement;
                }
                
                console.log('🔍 Selection Analysis:');
                console.log('  Text:', selectedText.substring(0, 30) + '...');
                console.log('  Element:', element.tagName, element.className);
                console.log('  Is Editable:', isEditable);
                console.log('  Should be Read-only:', !isEditable);
                
                if (!isEditable) {
                    console.log('✅ This should trigger read-only translation behavior');
                } else {
                    console.log('✏️ This should trigger editable text behavior');
                }
            }
        });
    </script>
</body>
</html>